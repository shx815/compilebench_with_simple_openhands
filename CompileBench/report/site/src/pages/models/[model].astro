---
import { getCollection } from 'astro:content';
import Base from '@/layouts/Base.astro';
import ContentContainer from '@/components/ContentContainer.astro';
import PageSection from '@/components/PageSection.astro';
import ModelBadge from '@/components/ModelBadge.astro';
import AttemptsTable from '@/components/AttemptsTable.astro';
import RegularTable from '@/components/RegularTable.astro';
import { taskDetailColumns } from '@/lib/tableColumns';
import { formatDuration } from '@/lib/utils';

export async function getStaticPaths() {
  const modelEntries = await getCollection('models');

  return modelEntries.map(entry => ({
    params: { model: entry.id },
    props: { data: entry.data }
  }));
}

const { data } = Astro.props;
---
<Base title={`CompileBench Model: ${data.model_name}`} description={`CompileBench performance results for ${data.model_name}. See success rates, costs, and execution times across real-world software build tasks.`}>
  <ContentContainer size="5xl">
    <div class="mb-3"><a href="/" class="text-blue-700 hover:text-blue-500 text-lg no-underline">&lt;- Ranking</a></div>
    <section id="model-details" class="my-6 mb-10">
      <div class="grid md:grid-cols-12 gap-x-8">
        <div class="md:col-span-3 pb-2">
          <div class="text-2xl font-bold">Model</div>
        </div>
        <div class="md:col-span-9 text-slate-700 leading-relaxed">
          <div class="flex items-center gap-2 text-slate-800 text-xl font-semibold mb-2">
            <ModelBadge
              model={data.model_name}
              openrouterSlug={data.openrouter_slug}
              isReasoning={data.is_reasoning}
            />
          </div>
          <div>Performance of {data.model_name} across tasks.</div>
        </div>
      </div>
    </section>

    <PageSection id="task-ranking" title="Task ranking">
      <RegularTable
        tableId="model-task-ranking-table"
        data={data.task_ranking.map((row, idx) => ({ ...row, rank: idx + 1 }))}
        columns={taskDetailColumns}
      />
    </PageSection>

    <PageSection id="attempts" title="Attempts" highlightText="">
      <AttemptsTable
        attempts={data.attempts}
        variant="by-model"
      />
    </PageSection>
  </ContentContainer>
</Base>


